<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Configure your Axion profile to begin cycle tracking.">
  <title>Get Started - Axion</title>
  <link rel="icon" type="image/svg+xml" href="../assets/favicon.svg">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap"
    rel="stylesheet">

  <!-- Theme (loaded first to prevent flash) -->
  <script src="../js/theme.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="../styles/animations.css">

  <style>
    .onboarding {
      min-height: 100vh;
      display: flex;
      align-items: center;
      padding: var(--space-12) 0;
    }

    .onboarding__form {
      max-width: 400px;
      margin: 0 auto;
    }

    .onboarding__header {
      margin-bottom: var(--space-8);
    }

    .onboarding__badge {
      font-size: var(--text-xs);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent-calm);
      margin-bottom: var(--space-3);
    }

    .onboarding__title {
      font-size: var(--text-2xl);
      margin-bottom: var(--space-3);
    }

    .onboarding__desc {
      color: var(--text-secondary);
      font-size: var(--text-base);
    }
  </style>
</head>

<body class="bg-primary">
  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="scanner"></div>
    <div class="loading-text">Initializing Axion Core</div>
  </div>

  <div class="container">
    <!-- Navigation -->
    <nav class="nav">
      <a href="../index.html" class="nav__logo">
        <span class="logo-main">Axion</span>
        <span class="logo-sub">Sync</span>
      </a>
    </nav>

    <!-- Onboarding -->
    <div class="onboarding">
      <div class="onboarding__form">
        <div class="onboarding__header">
          <div class="onboarding__badge">Configuration</div>
          <h1 class="onboarding__title">Set Up Your Profile</h1>
          <p class="onboarding__desc">Enter your cycle information to begin tracking.</p>
        </div>

        <form id="onboarding-form">
          <div class="form-group">
            <label class="form-label">Name (optional)</label>
            <input type="text" name="name" class="form-input" placeholder="Your name">
          </div>

          <div class="form-group">
            <label class="form-label">Average Cycle Length</label>
            <select name="cycleLength" class="form-input" required>
              <option value="26">26 days</option>
              <option value="27">27 days</option>
              <option value="28" selected>28 days</option>
              <option value="29">29 days</option>
              <option value="30">30 days</option>
              <option value="31">31 days</option>
              <option value="32">32 days</option>
              <option value="35">35 days</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Last Period Start Date</label>
            <input type="date" name="lastPeriodDate" class="form-input" required>
          </div>

          <button type="submit" class="btn btn--primary" style="width: 100%; margin-top: var(--space-6);">
            Begin Tracking
          </button>
        </form>

        <p style="margin-top: var(--space-6); font-size: var(--text-sm); color: var(--text-muted); text-align: center;">
          All data is stored locally on your device.
        </p>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="../js/cycle.js"></script>
  <script src="../js/storage.js"></script>
  <script src="../js/notifications.js"></script>
  <script src="../js/app.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Check if already onboarded
      if (window.MoodSyncStorage.isOnboarded()) {
        const profile = window.MoodSyncStorage.getUserProfile();
        document.querySelector('input[name="name"]').value = profile.name || '';
        document.querySelector('select[name="cycleLength"]').value = profile.cycleLength || 28;
      }

      // Set default date to a week ago
      const defaultDate = new Date();
      defaultDate.setDate(defaultDate.getDate() - 7);
      document.querySelector('input[name="lastPeriodDate"]').value = defaultDate.toISOString().split('T')[0];
    });

    document.getElementById('onboarding-form').addEventListener('submit', (e) => {
      e.preventDefault();

      const formData = new FormData(e.target);
      const name = formData.get('name');
      const cycleLength = formData.get('cycleLength');
      const lastPeriodDate = formData.get('lastPeriodDate');

      if (!lastPeriodDate) {
        return;
      }

      // Create profile
      window.MoodSyncStorage.createUserProfile(name, cycleLength, lastPeriodDate);
      window.MoodSyncStorage.generateLinkCode();

      // Show unique loading screen
      const overlay = document.getElementById('loading-overlay');
      const loadingText = overlay.querySelector('.loading-text');
      overlay.classList.add('active');

      const messages = [
        "Initializing Axion Core",
        "Calibrating human state signals",
        "Mapping cyclical parameters",
        "Synchronizing monitoring nodes"
      ];

      let msgIndex = 0;
      const interval = setInterval(() => {
        msgIndex++;
        if (msgIndex < messages.length) {
          loadingText.textContent = messages[msgIndex];
        } else {
          clearInterval(interval);
        }
      }, 600);

      // Navigate after delay
      setTimeout(() => {
        window.location.href = 'dashboard.html';
      }, 2500);
    });
  </script>
</body>

</html>