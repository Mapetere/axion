<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cycle tracking dashboard - View your current phase and share with partner.">
    <title>Dashboard - Axion</title>
    <link rel="icon" type="image/svg+xml" href="../assets/favicon.svg">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Theme (loaded first to prevent flash) -->
    <script src="../js/theme.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/animations.css">

    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-6);
            margin-top: var(--space-8);
        }

        .cycle-display {
            padding: var(--space-8);
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            text-align: center;
        }

        .cycle-display__day {
            font-family: var(--font-mono);
            font-size: 4rem;
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            line-height: 1;
        }

        .cycle-display__label {
            font-size: var(--text-sm);
            color: var(--text-muted);
            margin-top: var(--space-2);
        }

        .cycle-display__phase {
            margin-top: var(--space-4);
            padding: var(--space-2) var(--space-4);
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            display: inline-block;
            font-size: var(--text-sm);
            color: var(--accent-calm);
        }

        .info-panel {
            padding: var(--space-6);
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
        }

        .info-panel__title {
            font-size: var(--text-sm);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            margin-bottom: var(--space-4);
        }

        .info-panel__content {
            font-size: var(--text-base);
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .partner-code {
            font-family: var(--font-mono);
            font-size: var(--text-2xl);
            letter-spacing: 0.15em;
            color: var(--text-primary);
            margin: var(--space-4) 0;
        }

        .quick-actions {
            display: flex;
            gap: var(--space-3);
            margin-top: var(--space-6);
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="nav">
            <a href="../index.html" class="nav__logo">
                <span class="logo-main">Axion</span>
                <span class="logo-sub">Sync</span>
            </a>
            <ul class="nav__links">
                <li><a href="../index.html" class="nav__link">Status</a></li>
                <li><a href="partner.html" class="nav__link">Partner View</a></li>
                <li><a href="settings.html" class="nav__link">Settings</a></li>
            </ul>
        </nav>

        <!-- Dashboard Header -->
        <div class="status" style="padding-top: var(--space-8);">
            <div class="status__header">
                <span class="status__brand">Dashboard</span>
                <span class="status__day" id="current-date"></span>
            </div>

            <h2 id="greeting" style="margin-bottom: var(--space-2);">Welcome</h2>
            <p id="status-message" style="color: var(--text-secondary);">Loading cycle data...</p>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Cycle Display -->
            <div class="cycle-display">
                <div class="cycle-display__day" id="cycle-day">--</div>
                <div class="cycle-display__label">Day of <span id="cycle-length">--</span></div>
                <div class="cycle-display__phase" id="phase-badge">Loading...</div>
            </div>

            <!-- Next Period -->
            <div class="info-panel">
                <div class="info-panel__title">Next Period</div>
                <div class="info-panel__content">
                    <div style="font-size: var(--text-2xl); font-weight: var(--font-semibold); color: var(--text-primary);"
                        id="days-until">--</div>
                    <div style="color: var(--text-muted);">days remaining</div>
                    <div style="margin-top: var(--space-3); font-size: var(--text-sm);" id="next-date">--</div>
                </div>
            </div>

            <!-- Partner Code -->
            <div class="info-panel">
                <div class="info-panel__title">Partner Code</div>
                <div class="partner-code" id="link-code">------</div>
                <button class="btn btn--secondary" id="copy-code-btn">Copy Code</button>
            </div>

            <!-- Current Status -->
            <div class="info-panel">
                <div class="info-panel__title">Current Status</div>
                <div class="info-panel__content" id="user-insight">Loading...</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <button class="btn btn--primary" id="log-period-btn">Log Period</button>
            <button class="btn btn--secondary" id="log-mood-btn">Log Mood</button>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Axion - Cycle awareness system</p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="../js/cycle.js"></script>
    <script src="../js/storage.js"></script>
    <script src="../js/notifications.js"></script>
    <script src="../js/app.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (!window.MoodSyncStorage.isOnboarded()) {
                window.location.href = 'onboarding.html';
                return;
            }
            updateDashboard();
        });

        function updateDashboard() {
            const profile = window.MoodSyncStorage.getUserProfile();
            const cycleInfo = window.MoodSyncCycle.getCycleInfo(profile.lastPeriodDate, profile.cycleLength);

            // Update greeting
            const hour = new Date().getHours();
            let greeting = hour < 12 ? 'Good morning' : hour < 18 ? 'Good afternoon' : 'Good evening';
            document.getElementById('greeting').textContent = greeting + (profile.name ? ', ' + profile.name : '');

            // Update date
            document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', {
                weekday: 'long',
                month: 'short',
                day: 'numeric'
            });

            // Update cycle display
            document.getElementById('cycle-day').textContent = cycleInfo.currentDay;
            document.getElementById('cycle-length').textContent = cycleInfo.cycleLength;
            document.getElementById('phase-badge').textContent = cycleInfo.currentPhase.name;

            // Update next period
            document.getElementById('days-until').textContent = cycleInfo.daysUntilNext;
            document.getElementById('next-date').textContent = window.MoodSyncCycle.formatDate(cycleInfo.nextPeriod);

            // Update partner code
            const linkCode = window.MoodSyncStorage.getLinkCode();
            document.getElementById('link-code').textContent = linkCode;

            // Update status
            document.getElementById('status-message').textContent = cycleInfo.currentPhase.userMessage;
            document.getElementById('user-insight').textContent = cycleInfo.currentPhase.userMessage;

            // Event listeners
            document.getElementById('copy-code-btn').addEventListener('click', () => {
                navigator.clipboard.writeText(linkCode);
                document.getElementById('copy-code-btn').textContent = 'Copied';
                setTimeout(() => {
                    document.getElementById('copy-code-btn').textContent = 'Copy Code';
                }, 2000);
            });

            document.getElementById('log-period-btn').addEventListener('click', () => {
                window.MoodSyncApp.showModal(`
                    <form id="log-period-form">
                        <div class="form-group">
                            <label class="form-label">Period Start Date</label>
                            <input type="date" name="startDate" class="form-input" value="${new Date().toISOString().split('T')[0]}" required>
                        </div>
                        <button type="submit" class="btn btn--primary" style="width: 100%; margin-top: var(--space-4);">Log Period</button>
                    </form>
                `, { title: 'Log Period' });
            });

            document.getElementById('log-mood-btn').addEventListener('click', () => {
                window.MoodSyncApp.showModal(`
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-3);">
                        <button class="action-btn" data-mood="great" onclick="logMood('great')">Great</button>
                        <button class="action-btn" data-mood="good" onclick="logMood('good')">Good</button>
                        <button class="action-btn" data-mood="okay" onclick="logMood('okay')">Okay</button>
                        <button class="action-btn" data-mood="tired" onclick="logMood('tired')">Tired</button>
                        <button class="action-btn" data-mood="stressed" onclick="logMood('stressed')">Stressed</button>
                        <button class="action-btn" data-mood="low" onclick="logMood('low')">Low</button>
                    </div>
                `, { title: 'Log Mood' });
            });
        }

        function logMood(mood) {
            window.MoodSyncStorage.logMood(mood);
            window.MoodSyncApp.closeModal();
        }
    </script>
</body>

</html>